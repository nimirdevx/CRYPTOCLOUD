version: '3.8'

services:
  # 1. The MongoDB Database Service
  database:
    image: mongo:latest
    container_name: cryptocloud-mongo
    ports:
      - "27017:27017" # Exposes the database to your host machine (for debugging)
    volumes:
      - mongo-data:/data/db
    restart: always

  # 2. The FastAPI Backend Service
  backend:
    build: ./backend # Tells Docker to use the Dockerfile in the ./backend folder
    container_name: cryptocloud-backend
    ports:
      - "8000:8000" # Maps your host port 8000 to the container's port 8000
    env_file:
      - ./backend/.env # Passes your .env file to the container
    depends_on:
      - database # Tells Docker to start the database *before* the backend
    restart: always

  # 3. The Next.js Frontend Service
  frontend:
    build: ./frontend # Tells Docker to use the Dockerfile in the ./frontend folder
    container_name: cryptocloud-frontend
    ports:
      - "3000:3000" # Maps your host port 3000 to the container's port 3000
    depends_on:
      - backend # Tells Docker to start the backend *before* the frontend
    restart: always

# Defines the 'mongo-data' volume to persist database data
volumes:
  mongo-data: